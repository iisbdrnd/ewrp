(function(window){function Gauge(options){var properties={tick_length:80,large_tick_length:110,tick_thickness:6,num_sub_ticks:9,total_degrees:140,tick_color:"#555962",tick_on_color:"#527d98",tick_on_glow:35,bg_image:null,gauge_scale:1,animation_duration:550};var objectKeys=Object.keys||function(o){var result=[];for(var name in o){result.push(name)}return result};this._property_list=objectKeys(properties);for(var k in properties){this[k]=options[k]||properties[k]}
this.canvas=options.canvas;if(typeof(G_vmlCanvasManager)!='undefined'&&G_vmlCanvasManager!=null){G_vmlCanvasManager.initElement(this.canvas)}
this.context=this.canvas.getContext("2d");this._percent=options.percent||0;this._target_percent=this._percent;return this}
Gauge.prototype._requestAnimFrame=function(f){var anim=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(function(){callback(+new Date)},1000/60)};anim(f)};Gauge.prototype.getCurrentState=function(){var state={};for(var i in this._property_list){var prop=this._property_list[i];state[prop]=this[prop]}
state.percent=this._target_percent;return state};Gauge.prototype._applyBG=function(){var canvas=this.canvas;var context=this.context;if(this.bg_color){context.save();context.fillStyle=this.bg_color;context.fillRect(0,0,canvas.width,canvas.height);context.restore()}
if(this.bg_image){if(!this.bg_image_obj){this.bg_image_obj=new Image();var _this=this;this.bg_image_obj.onload=function(){_this.bg_image_loaded=!0;context.drawImage(_this.bg_image_obj,canvas.width/2-_this.bg_image.width/2+_this.bg_image.xoffset,canvas.height-_this.bg_image.height-_this.bg_image.yoffset,_this.bg_image.width,_this.bg_image.height)};this.bg_image_obj.src=this.bg_image.url}
else{if(this.bg_image_loaded){context.drawImage(this.bg_image_obj,canvas.width/2-this.bg_image.width/2+this.bg_image.xoffset,canvas.height-this.bg_image.height-this.bg_image.yoffset)}}}};Gauge.prototype._prepareStage=function(){var canvas=this.canvas;var context=this.context;context.clearRect(0,0,canvas.width,canvas.height);this._applyBG();context.translate(canvas.width/2,canvas.height-this.tick_thickness/2);context.scale(this.gauge_scale,this.gauge_scale)};Gauge.prototype.render=function(){var canvas=this.canvas;var context=this.context;context.save();this._prepareStage();var num_ticks=5+this.num_sub_ticks*4;var rotation_deg=this.total_degrees/(num_ticks-1);var starting_deg=(180-this.total_degrees)/2;context.rotate(starting_deg*Math.PI/180);for(var i=1;i<=num_ticks;i++){var is_on=((i/num_ticks)*100<=this._percent);var rect_scale=(i+this.num_sub_ticks)%((num_ticks-1)/4)===0?this.large_tick_scale:1;var tick_length=(i+this.num_sub_ticks)%((num_ticks-1)/4)===0?this.large_tick_length:this.tick_length;var color=is_on?this.tick_on_color:this.tick_color;context.fillStyle=color;context.shadowBlur=is_on?this.tick_on_glow:0;context.shadowColor=color;context.fillRect(-1*(canvas.width/2),-this.tick_thickness/2,tick_length,this.tick_thickness);context.rotate(rotation_deg*Math.PI/180)}
context.restore();return!0};Gauge.prototype.updatePercent=function(percent,options){var _this=this;this._target_percent=percent;options=options||{};var duration=('animation_duration' in options)?options.animation_duration:_this.animation_duration;if(duration){var lastUpdate=new Date().getTime();var start=this._percent;var end=this._target_percent;var change_per_ms=(end-start)/duration;var increasing=change_per_ms>0?1:0;var update=function(){var now=new Date().getTime();var elapsed=now-lastUpdate;_this._percent+=elapsed*change_per_ms;lastUpdate=now;if((increasing&&_this._percent<_this._target_percent)||(!increasing&&_this._percent>_this._target_percent)){_this.render();_this._requestAnimFrame(update)}
else{_this._percent=_this._target_percent;_this.render()}};_this._requestAnimFrame(update)}
else{_this._percent=percent;_this.render()}};window.fabledweb=window.fabledweb||{};window.fabledweb.Gauge=Gauge})(window)