(function($){"use strict";$.fn.extend({maxlength:function(options,callback){var documentBody=$('body'),defaults={alwaysShow:!1,threshold:10,warningClass:"label label-success",limitReachedClass:"label label-important",separator:' / ',preText:'',postText:'',showMaxLength:!0,placement:'bottom',showCharsTyped:!0,validate:!1};if($.isFunction(options)&&!callback){callback=options;options={}}
options=$.extend(defaults,options);function inputLength(input){var text=input.val(),matches=text.match(/\n/g),breaks=matches?matches.length:0;return input.val().length+breaks}
function charsLeftThreshold(input,thereshold,maxlength){var output=!0;if(!options.alwaysShow&&(maxlength-inputLength(input)>thereshold)){output=!1}
return output}
function remainingChars(input,maxlength){var length=maxlength-inputLength(input);return length}
function showRemaining(indicator){indicator.css({display:'block'})}
function hideRemaining(indicator){indicator.css({display:'none'})}
function updateMaxLengthHTML(maxLengthThisInput,typedChars){var output='';if(options.preText){output+=options.preText}
if(!options.showCharsTyped){output+=remainingChars(typedChars,maxLengthThisInput)}
else{output+=typedChars}
if(options.showMaxLength){output+=options.separator+maxLengthThisInput}
if(options.postText){output+=options.postText}
return output}
function manageRemainingVisibility(remaining,currentInput,maxLengthCurrentInput,maxLengthIndicator){maxLengthIndicator.html(updateMaxLengthHTML(maxLengthCurrentInput,(maxLengthCurrentInput-remaining)));if(remaining>0){if(charsLeftThreshold(currentInput,options.threshold,maxLengthCurrentInput)){showRemaining(maxLengthIndicator.removeClass(options.limitReachedClass).addClass(options.warningClass))}else{hideRemaining(maxLengthIndicator)}}else{showRemaining(maxLengthIndicator.removeClass(options.warningClass).addClass(options.limitReachedClass))}}
function getPosition(currentInput){var el=currentInput[0];return $.extend({},(typeof el.getBoundingClientRect==='function')?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},currentInput.offset())}
function place(currentInput,maxLengthIndicator){var pos=getPosition(currentInput),inputOuter=currentInput.outerWidth(),outerWidth=maxLengthIndicator.outerWidth(),actualWidth=maxLengthIndicator.width(),actualHeight=maxLengthIndicator.height();switch(options.placement){case 'bottom':maxLengthIndicator.css({top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2});break;case 'top':maxLengthIndicator.css({top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2});break;case 'left':maxLengthIndicator.css({top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth});break;case 'right':maxLengthIndicator.css({top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width});break;case 'bottom-right':maxLengthIndicator.css({top:pos.top+pos.height,left:pos.left+pos.width});break;case 'top-right':maxLengthIndicator.css({top:pos.top-actualHeight,left:pos.left+inputOuter});break;case 'top-left':maxLengthIndicator.css({top:pos.top-actualHeight,left:pos.left-outerWidth});break;case 'bottom-left':maxLengthIndicator.css({top:pos.top+currentInput.outerHeight(),left:pos.left-outerWidth});break;case 'centered-right':maxLengthIndicator.css({top:pos.top+(actualHeight/2),left:pos.left+inputOuter-outerWidth-3});break}}
function getMaxLength(currentInput){return currentInput.attr('maxlength')||currentInput.attr('size')}
return this.each(function(){var currentInput=$(this),maxLengthCurrentInput=getMaxLength(currentInput),maxLengthIndicator=$('<span></span>').css({display:'none',position:'absolute',whiteSpace:'nowrap',zIndex:999}).html(updateMaxLengthHTML(maxLengthCurrentInput,'0'));if(currentInput.is('textarea')){currentInput.data('maxlenghtsizex',currentInput.outerWidth());currentInput.data('maxlenghtsizey',currentInput.outerHeight());currentInput.mouseup(function(){if(currentInput.outerWidth()!==currentInput.data('maxlenghtsizex')||currentInput.outerHeight()!==currentInput.data('maxlenghtsizey')){place(currentInput,maxLengthIndicator)}
currentInput.data('maxlenghtsizex',currentInput.outerWidth());currentInput.data('maxlenghtsizey',currentInput.outerHeight())})}
documentBody.append(maxLengthIndicator);currentInput.focus(function(){var remaining=remainingChars(currentInput,getMaxLength(currentInput));manageRemainingVisibility(remaining,currentInput,maxLengthCurrentInput,maxLengthIndicator);place(currentInput,maxLengthIndicator)});$(window).resize(function(){place(currentInput,maxLengthIndicator)});currentInput.blur(function(){maxLengthIndicator.css('display','none')});currentInput.keyup(function(e){var remaining=remainingChars(currentInput,getMaxLength(currentInput)),output=!0,keyCode=e.keyCode||e.which;if(remaining===0&&keyCode===9&&!e.shiftKey){currentInput.attr('maxlength',getMaxLength(currentInput)+1).trigger({type:'keypress',which:9}).attr('maxlength',getMaxLength(currentInput)-1)}
if(options.validate&&remaining<0){output=!1}else{manageRemainingVisibility(remaining,currentInput,maxLengthCurrentInput,maxLengthIndicator)}
return output})})}})}(jQuery))